<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blog - Wen ZENG</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header>
      <nav class="navbar">
        <div class="logo">
          <a href="index.html">Wen ZENG</a>
        </div>
        <ul class="nav-links">
          <li><a href="index.html">Home</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="projects.html">Projects</a></li>
          <li><a href="blog.html">Blog</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
        <div class="hamburger">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </nav>
    </header>

    <main>
      <section class="section-blog">
        <div class="blog-container">
          <h1>My Blog Posts</h1>
          <div id="blog-posts" class="blog-posts-grid">
            <!-- Posts will be loaded here -->
            <div class="loading">Loading posts...</div>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <p>&copy; 2024 Wen ZENG. All rights reserved.</p>
    </footer>

    <script>
      async function fetchBlogPosts() {
        const query = `
                query {
                    publication(host: "wen-zeng.hashnode.dev") {
                        posts(first: 10) {
                            edges {
                                node {
                                    title
                                    brief
                                    slug
                                    publishedAt
                                    coverImage {
                                        url
                                    }
                                    url
                                }
                            }
                        }
                    }
                }
            `;

        try {
          const response = await fetch("https://gql.hashnode.com", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ query }),
          });

          const data = await response.json();
          console.log("Full API Response:", data); // More detailed logging

          const blogPostsContainer = document.getElementById("blog-posts");

          // Check if we have a publication
          if (!data.data || !data.data.publication) {
            blogPostsContainer.innerHTML = `
                        <div class="no-posts">
                            <p>Please finish setting up your Hashnode blog to see your posts here.</p>
                            <p>Steps to complete setup:</p>
                            <ol>
                                <li>Go to <a href="https://hashnode.com/onboard" target="_blank">Hashnode Onboarding</a></li>
                                <li>Set up your blog/publication</li>
                                <li>Write your first post</li>
                            </ol>
                            <p>Or visit my profile directly on 
                                <a href="https://hashnode.com/@Wen-Zeng" target="_blank">Hashnode</a>
                            </p>
                        </div>
                    `;
            return;
          }

          const posts = data.data.publication.posts.edges;

          if (posts && posts.length > 0) {
            blogPostsContainer.innerHTML = posts
              .map(
                ({ node: post }) => `
                        <article class="blog-post-card">
                            ${
                              post.coverImage
                                ? `<img src="${post.coverImage.url}" alt="${post.title}" class="post-cover">`
                                : ""
                            }
                            <div class="post-content">
                                <h2>${post.title}</h2>
                                <div class="post-date">${new Date(
                                  post.publishedAt
                                ).toLocaleDateString("en-US", {
                                  year: "numeric",
                                  month: "long",
                                  day: "numeric",
                                })}</div>
                                <p class="post-brief">${post.brief || ""}</p>
                                <a href="${
                                  post.url
                                }" target="_blank" class="read-more">Read More</a>
                            </div>
                        </article>
                    `
              )
              .join("");
          } else {
            blogPostsContainer.innerHTML = `
                        <div class="no-posts">
                            <p>No blog posts found yet. Start writing on 
                                <a href="https://hashnode.com/write" target="_blank">Hashnode</a>
                                to see your posts here!
                            </p>
                        </div>
                    `;
          }
        } catch (error) {
          console.error("Error details:", error); // More detailed error logging
          document.getElementById("blog-posts").innerHTML = `
                    <div class="error-message">
                        <p>Unable to load blog posts. Please try again later or visit my blog directly on 
                            <a href="https://hashnode.com/@Wen-Zeng" target="_blank">Hashnode</a>
                        </p>
                    </div>
                `;
        }
      }

      // Load posts when the page loads
      fetchBlogPosts();
    </script>
  </body>
</html>
